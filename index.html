<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <link href="./app.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <title>Vanilla App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div class="app">
      <div class="card v-card rounded-4 m-3" >
        <div class="card-body">
          <h3 class="card-title text-black text-center mt-2 text-bold">This is a technical proof</h3>
          <p class="card-subtitle mb-2 text-muted text-black text-center mt-1 mb-2">Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime mollitia,
            molestiae quas vel sint commodi repudiandae consequuntur voluptatum laborum
            numquam blanditiis harum quisquam eius sed odit fugiat iusto fuga praesentium
            optio, eaque rerum!.
          </p>
          <ul id="list" class="list-group rounded-0 py-1 px-2">
            
          </ul>
          <div class="d-flex justify-content-between my-3">
            <div>
              <button id="rollback-button" type="button" class="btn-sm delete-button v-icon-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                  <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
                </svg>
              </button>
              <button id="delete-button" type="button" class="btn-sm delete-button v-button">DELETE</Button>
            </div>
            <div>
              <button type="button" class="add-button v-button btn-sm" data-bs-toggle="modal" data-bs-target="#add-modal">ADD</Button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="add-modal" tabindex="-1" aria-labelledby="add-modal-label" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body">
            <form>
              <div class="form-group m-3">
                <label for="text">Add item to list</label>
                <input id="new-item" type="text" class="form-control rounded-0 list-group-bg" id="text" placeholder="Type the text here..." autoFocus>
              </div>
            </form>
          </div>
          <div class="modal-footer border-0">
            <button id="add-button" type="button" class="add-button v-button btn-sm">ADD</Button>
            <button id="cancel-button" type="button" class="delete-button v-button btn-sm" data-bs-dismiss="modal">CANCEL</Button>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.6.0/umd/popper.min.js" integrity="sha512-BmM0/BQlqh02wuK5Gz9yrbe7VyIVwOzD1o40yi1IsTjriX/NGF37NyXHfmFzIlMmoSIBXgqDiG1VNU6kB5dBbA==" crossorigin="anonymous"></script>
    <script>
      window.addEventListener("load", (event) => {
        var list = [
          { 
            id: randomId("item"),
            name: "Item 1",
            checked: false
          },
          {
            id: randomId("item"),
            name: "Item 2",
            checked: false
          },
          {
            id: randomId("item"),
            name: "Item 3",
            checked: false
          },
          {
            id: randomId("item"),
            name: "Item 4",
            checked: false
          }
        ];
        var lastItemRemove = [];
        var addBtn = document.getElementById("add-button");
        var rollbackBtn = document.getElementById("rollback-button");
        var deleteBtn = document.getElementById("delete-button");

        function randomId (prefix) {
          return `${prefix}-${Math.random().toString(16).slice(-4)}`;
        }

        function load() {
          var elList = document.getElementById("list");
          while (elList.firstChild) {
            elList.removeChild(elList.firstChild);
          }
          var lis = "";
          list.map((e, i) => {
            lis += `
              <li id="${e.id}" class="list-group-item px-2 m-0 mt-1 border-0" data-index="${i}">
                <p class="m-0 py-1">${e.name}</p>
              </li>
            `;
          });
          elList.insertAdjacentHTML('beforeend', lis);
          attachEvents();
        }

        function attachEvents() {
          const elements = document.querySelectorAll('.list-group-item');
          elements.forEach(element => {
            element.addEventListener('click', function(e) {
              e.preventDefault();
              if (e.target.classList.contains('form-check-label')) {
                e.target.classList.remove('form-check-label');
              } else {
                e.target.classList.add('form-check-label');
              }
              var index = this.getAttribute("data-index");
              list[index].checked = !list[index].checked;
            });
            element.addEventListener('dblclick', function(e) {
              e.preventDefault();
              if (e.target.classList.contains('form-check-label')) {
                e.target.classList.remove('form-check-label');
              } else {
                e.target.classList.add('form-check-label');
              }
              var id = this.getAttribute("id");
              document.getElementById(id).remove();
              lastItemRemove = list;
              list = list.filter((e, i) => {
                return e.id != id;
              });
            });
          });
        }

        deleteBtn.addEventListener('click', function(e) {
          var del = list.some((e) => {
            return e["checked"] === true;
          })
          if (del) {
            lastItemRemove = list;
            list = list.filter((e, i) => {
              return !e.checked;
            });
            load();
          } else {
            alert("Select an item");
          }
        });

        addBtn.addEventListener('click', function(e) {
          var newItem = document.getElementById("new-item").value;
          if (newItem != "") {
            var id = randomId("item");
            list = [
              ...list, 
              {
                id,
                name: newItem,
                checked: false
              }
            ];
            document.getElementById("cancel-button").click();
            load();
          }
        });

        rollbackBtn.addEventListener('click', function(e) {
          if (lastItemRemove.length > 0) {
            list = lastItemRemove.map((e) => ({...e, checked: false}));
            lastItemRemove = [];
            load();
          }
        });

        load();
      });
    </script>
  </body>
</html>